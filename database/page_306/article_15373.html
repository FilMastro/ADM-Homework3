<!DOCTYPE html>
<html lang="en">
 <head>
  <title>
   MyAnimeList
  </title>
  <meta charset="utf-8"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="noindex,nofollow" name="robots"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <script src="//www.google.com/recaptcha/api.js?render=6Ld_1aIZAAAAAF6bNdR67ICKIaeXLKlbhE7t2Qz4">
  </script>
  <script crossorigin="anonymous" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" src="//code.jquery.com/jquery-3.5.1.min.js">
  </script>
  <link href="//fonts.googleapis.com/css?family=Roboto:400,700&amp;display=swap" rel="stylesheet"/>
  <style type="text/css">
   * { font-family: Roboto; }
    body { background-color: #2e51a2; color: #ffffff; margin: 0 auto; text-align: center; font-size: 16px; }
    .container { display: flex; height: 100vh; flex-direction: column; justify-content: center; align-items: center; }
    .mal-logo { width: 200px; height: 34px; margin-bottom: 24px; background-image: url('/pages/logo_mal.png'); background-size: contain; background-repeat: no-repeat; }
    .caption { line-height: 2rem; }
    .display-verify { display: none; }
    .display-form { display: block; }
    .error { display: none; color: #ee817B; }
    .circle-block { width: 120px; display: flex; justify-content: space-between; }
    .circle-block-container { display: inline-block; margin: 24px; }
    .circle { width: 15px; height: 15px; background-color: #ffffff; border-radius: 50%; animation: loading 2s infinite; }
    .circle:nth-child(2) { animation-delay: 0.2s; }
    .circle:nth-child(3) { animation-delay: 0.4s; }
    .circle:nth-child(4) { animation-delay: 0.6s; }
    .circle:nth-child(5) { animation-delay: 0.8s; }
    @keyframes loading {
      0% { transform: scale(1); }
      10% { transform: scale(0.1); }
      100% { transform: scale(1); }
    }
    #reform { margin: 24px 0; }
    button { background-color: transparent; border: 2px solid #ffffff; border-radius: 20px; height: 40px; width: 120px; color: #ffffff; font-size: 18px; }
    button:hover, button:active { background-color: #ffffff; color: #2e51a2; }
  </style>
  <script>
   var verifier_url = "//grverify.myanimelist.net/verify";
    var retried = 0;
    function onSubmit(event){
      $('.display-submit').hide();
      $('.display-verify').show();
      grecaptcha.ready(function(){
        grecaptcha.execute('6Ld_1aIZAAAAAF6bNdR67ICKIaeXLKlbhE7t2Qz4', {action: 'submit'}).then(function(token){
          const checkAccess = function(){
            $.ajax({
              type: 'post',
              url: '/static/grcheck.json',
              contentType: 'application/json',
              dataType: 'json',
              cache: false,
              success: function(data){
                if(data.success){
                  location.reload();
                  return;
                }
                $('.display-submit').show();
                $('.display-verify').hide();
                $('.display-submit .error').show();
              },
              error: function(){
                if(++retried < 20){
                  setTimeout(checkAccess, 3000);
                  return;
                }
                $('.display-submit').show();
                $('.display-verify').hide();
                $('.display-submit .error').show();
              }
            });
          };
          $.ajax({
            type: 'post',
            url: verifier_url,
            contentType: 'application/json',
            data: JSON.stringify({verifier:token}),
            dataType: 'json',
            success: function(data){
              setTimeout(checkAccess, 3000);
            },
            error: function(){
              $('.display-submit').show();
              $('.display-verify').hide();
              $('.display-submit .error').show();
            }
          });
        });
      });
      event.preventDefault();
    }
    $(document).ready(function(){
      $('#reform').on('submit', onSubmit);
    });
  </script>
 </head>
 <body>
  <div class="container">
   <div class="mal-logo">
   </div>
   <div class="display-verify">
    <div class="circle-block-container">
     <div class="circle-block">
      <div class="circle">
      </div>
      <div class="circle">
      </div>
      <div class="circle">
      </div>
      <div class="circle">
      </div>
      <div class="circle">
      </div>
     </div>
    </div>
    <div class="caption">
     Checking your request. Please wait a moment...
     <br/>
     Thank you for your cooperation!
     <br/>
    </div>
   </div>
   <div class="display-submit">
    <div class="caption">
     We are temporarily restricting site connections due to heavy access.
     <br/>
     Please click "Submit" to verify that you are not a bot.
     <br/>
     <div class="error">
      Some error occured. please try again.
     </div>
    </div>
    <form id="reform">
     <button class="g-recaptcha" data-action="submit" data-callback="onSubmit" data-sitekey="6Ld_1aIZAAAAAF6bNdR67ICKIaeXLKlbhE7t2Qz4" type="submit">
      Submit
     </button>
    </form>
   </div>
  </div>
 </body>
</html>
